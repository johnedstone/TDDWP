<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>Javascript tests</title>
    <link rel="stylesheet" href="../../../superlists/static/tests/qunit.css">
</head>

<body>
    <div id="qunit"></div>
    <div id="qunit-fixture">
      <a id="id_login">Sign in</a>
    </div>

    <script src="http://code.jquery.com/jquery.min.js"></script>
    <script src="../../../superlists/static/tests/qunit.js"></script>
    <script src="../../../superlists/static/tests/sinon.js"></script>
    <script src="../accounts.js"></script>
    <script>
/* global $, test, equal */

QUnit.test("initialize binds sign in button to navigator.id.request", function(assert) {
    var requestWasCalled = false;
    var mockRequestFunction = function () { requestWasCalled = true; };
    var mockNavigator = {
        id: {
            request: mockRequestFunction,
            watch: function () {}
        }
    };

    Superlists.Accounts.initialize(mockNavigator);

    assert.equal(requestWasCalled, false, 'check request not called before click');
    $('#id_login').trigger('click');
    assert.equal(requestWasCalled, true, 'check request called after click');

});

QUnit.test("initialize calls navigator.id.watch", function(assert) {
    var user = 'current user';
    var token = 'csrf token';
    var urls = {login: 'login_url', logout: 'logout_url'};
    var mockNavigator = {
        id: {
            watch: sinon.mock()
        }
    };
    Superlists.Accounts.initialize(mockNavigator, user, token, urls);
    assert.equal(
        mockNavigator.id.watch.calledOnce,
        true,
        'check watch function called'
    );
});
QUnit.test("watch sees current user", function(assert) {
    var user = 'current user';
    var token = 'csrf token';
    var urls = {login: 'login_url', logout: 'logout_url'};
    var mockNavigator = {
        id: {
            watch: sinon.mock()
        }
    };
    Superlists.Accounts.initialize(mockNavigator, user, token, urls);
    var watchCallArgs = mockNavigator.id.watch.firstCall.args[0];
    assert.equal(
        watchCallArgs.loggedInUser,
        user,
        'check user'
    );
});
/*
QUnit.test("errors should be hidden on keypress", function (assert){
    // This is in list.js, but appears to be removed from
    // there when the QUnit tests are run.  So, adding here as well.
    // There must be a better way ..
    //

    jQuery('input').on('keypress', function () {
        jQuery('.has-error').hide();
    });

    jQuery('input').trigger('keypress');
    assert.equal(jQuery('.has-error').is(':visible'), false);
});

QUnit.test("errors not be hidden unless there is a keypress", function(assert) {

    jQuery('input').on('keypress', function () {
        jQuery('.has-error').hide();
    });

    assert.equal(jQuery('.has-error').is(':visible'), true);
});
*/


/*
QUnit.test("smoke test", function(assert) {
    assert.equal($('.has-error').is(':visible'), true);
    $('.has-error').hide();
    assert.equal($('.has-error').is(':visible'), false);
});

QUnit.test("smoke test 2", function(assert) {
    assert.equal($('.has-error').is(':visible'), true);
    $('.has-error').hide();
    assert.equal($('.has-error').is(':visible'), false);
});
*/
    </script>
</body>
</html>
